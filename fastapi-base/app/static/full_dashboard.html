<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pipeline MXH - Full Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 12px 24px rgba(0,0,0,0.15); }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .tab-active { border-bottom: 3px solid #667eea; color: #667eea; }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; }
        .status-healthy { background: #10b981; }
        .status-degraded { background: #f59e0b; }
        .status-unhealthy { background: #ef4444; }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Header -->
    <header class="gradient-bg text-white py-4 px-6 shadow-lg">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold">üöÄ Pipeline MXH</h1>
                <p class="text-sm opacity-80">Crawl ‚Üí ETL ‚Üí NER ‚Üí Topic ‚Üí Dashboard</p>
            </div>
            <div class="flex items-center space-x-4">
                <div id="health-indicator" class="flex items-center space-x-2">
                    <div class="status-dot status-healthy"></div>
                    <span class="text-sm">System OK</span>
                </div>
                <button onclick="refreshAll()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-6">
            <div class="flex space-x-8">
                <button onclick="showTab('overview')" class="tab-btn py-4 px-2 tab-active" data-tab="overview">
                    <i class="fas fa-chart-pie mr-2"></i>Overview
                </button>
                <button onclick="showTab('pipeline')" class="tab-btn py-4 px-2" data-tab="pipeline">
                    <i class="fas fa-rocket mr-2"></i>Pipeline
                </button>
                <button onclick="showTab('topics')" class="tab-btn py-4 px-2" data-tab="topics">
                    <i class="fas fa-tags mr-2"></i>Topics
                </button>
                <button onclick="showTab('hitl')" class="tab-btn py-4 px-2" data-tab="hitl">
                    <i class="fas fa-user-check mr-2"></i>HITL Review
                </button>
                <button onclick="showTab('monitoring')" class="tab-btn py-4 px-2" data-tab="monitoring">
                    <i class="fas fa-heartbeat mr-2"></i>Monitoring
                </button>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-6 py-6">
        <!-- Overview Tab -->
        <div id="tab-overview" class="tab-content">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                <div class="bg-white rounded-xl shadow-md p-6 card-hover transition-all">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm">Documents</p>
                            <p id="stat-documents" class="text-3xl font-bold text-gray-800">-</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-file-alt text-blue-600 text-xl"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-md p-6 card-hover transition-all">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm">Topics</p>
                            <p id="stat-topics" class="text-3xl font-bold text-gray-800">-</p>
                        </div>
                        <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-tags text-purple-600 text-xl"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-md p-6 card-hover transition-all">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm">Sources</p>
                            <p id="stat-sources" class="text-3xl font-bold text-gray-800">-</p>
                        </div>
                        <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-globe text-green-600 text-xl"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-md p-6 card-hover transition-all">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm">Data Size</p>
                            <p id="stat-size" class="text-3xl font-bold text-gray-800">-</p>
                        </div>
                        <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-database text-orange-600 text-xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">üìà Document Timeline</h3>
                    <canvas id="timeline-chart" height="200"></canvas>
                </div>
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">üìä Topic Distribution</h3>
                    <canvas id="topic-chart" height="200"></canvas>
                </div>
            </div>

            <!-- Top Topics & Recent Activity -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">üî• Hot Topics</h3>
                    <div id="top-topics" class="space-y-3">
                        <p class="text-gray-500">Loading...</p>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">üïê Recent Activity</h3>
                    <div id="recent-activity" class="space-y-3">
                        <p class="text-gray-500">Loading...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pipeline Tab -->
        <div id="tab-pipeline" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4">üöÄ Run Full Pipeline</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <input type="text" id="pipeline-url" placeholder="https://example.com" 
                           class="border rounded-lg px-4 py-3 focus:ring-2 focus:ring-purple-500">
                    <select id="pipeline-mode" class="border rounded-lg px-4 py-3">
                        <option value="quick">Quick (50 pages)</option>
                        <option value="max" selected>Max (5000 pages)</option>
                        <option value="full">Full (10000 pages)</option>
                    </select>
                    <button onclick="runPipeline()" class="bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg px-6 py-3 hover:opacity-90">
                        <i class="fas fa-play mr-2"></i>Run Pipeline
                    </button>
                </div>
                <div class="flex space-x-4">
                    <label class="flex items-center">
                        <input type="checkbox" id="pipeline-topics" checked class="mr-2"> Train Topics
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" id="pipeline-ner" checked class="mr-2"> Extract NER
                    </label>
                </div>
            </div>

            <!-- Running Tasks -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-lg font-semibold mb-4">üìã Tasks</h3>
                <div id="tasks-list" class="space-y-3">
                    <p class="text-gray-500">No tasks running</p>
                </div>
            </div>
        </div>

        <!-- Topics Tab -->
        <div id="tab-topics" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-lg font-semibold mb-4">üìä All Topics</h3>
                <div id="all-topics" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <p class="text-gray-500">Loading...</p>
                </div>
            </div>
        </div>

        <!-- HITL Review Tab -->
        <div id="tab-hitl" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4">üìù Pending Reviews</h3>
                <div id="pending-reviews" class="space-y-4">
                    <p class="text-gray-500">No pending reviews</p>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-lg font-semibold mb-4">üìà Review Stats</h3>
                <div id="review-stats" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <p class="text-gray-500">Loading...</p>
                </div>
            </div>
        </div>

        <!-- Monitoring Tab -->
        <div id="tab-monitoring" class="tab-content hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">üíª System Metrics</h3>
                    <div id="system-metrics" class="space-y-4">
                        <p class="text-gray-500">Loading...</p>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">üè• Health Checks</h3>
                    <div id="health-checks" class="space-y-3">
                        <p class="text-gray-500">Loading...</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-lg font-semibold mb-4">üìä Pipeline Stats</h3>
                <div id="pipeline-stats" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <p class="text-gray-500">Loading...</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        const API_BASE = '';  // Same origin
        let timelineChart, topicChart;

        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('tab-active'));
            document.getElementById(`tab-${tabName}`).classList.remove('hidden');
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('tab-active');
            
            // Load tab-specific data
            if (tabName === 'monitoring') loadMonitoring();
            if (tabName === 'hitl') loadHITL();
            if (tabName === 'pipeline') loadTasks();
            if (tabName === 'topics') loadAllTopics();
        }

        // Refresh all data
        async function refreshAll() {
            await Promise.all([loadOverview(), loadHealth()]);
        }

        // Load overview data
        async function loadOverview() {
            try {
                const res = await fetch(`${API_BASE}/api/dashboard`);
                const data = await res.json();
                
                document.getElementById('stat-documents').textContent = data.total_documents?.toLocaleString() || '0';
                document.getElementById('stat-topics').textContent = data.total_topics || '0';
                document.getElementById('stat-sources').textContent = data.total_sources || '0';
                document.getElementById('stat-size').textContent = `${data.stats?.data_size_mb || 0} MB`;

                // Top Topics
                const topicsHtml = (data.top_topics || []).slice(0, 5).map(t => `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div>
                            <p class="font-medium">${t.name || 'Topic ' + t.topic_id}</p>
                            <p class="text-sm text-gray-500">${(t.keywords || []).join(', ')}</p>
                        </div>
                        <span class="bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-sm">${t.count}</span>
                    </div>
                `).join('') || '<p class="text-gray-500">No topics</p>';
                document.getElementById('top-topics').innerHTML = topicsHtml;

                // Recent Activity
                const activityHtml = (data.recent_activity || []).slice(0, 5).map(a => `
                    <div class="flex items-center space-x-3 p-2">
                        <i class="fas fa-${a.type === 'crawl' ? 'spider' : 'brain'} text-${a.type === 'crawl' ? 'blue' : 'green'}-500"></i>
                        <div>
                            <p class="text-sm font-medium">${a.file || a.model}</p>
                            <p class="text-xs text-gray-500">${new Date(a.timestamp).toLocaleString()}</p>
                        </div>
                    </div>
                `).join('') || '<p class="text-gray-500">No activity</p>';
                document.getElementById('recent-activity').innerHTML = activityHtml;

                // Update charts
                updateCharts(data);
            } catch (e) {
                console.error('Load overview error:', e);
            }
        }

        // Update charts
        function updateCharts(data) {
            // Timeline chart
            fetch(`${API_BASE}/api/dashboard/charts/timeline`)
                .then(r => r.json())
                .then(timeline => {
                    if (timelineChart) timelineChart.destroy();
                    const ctx = document.getElementById('timeline-chart').getContext('2d');
                    timelineChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: timeline.dates || [],
                            datasets: [{
                                label: 'Documents',
                                data: timeline.cumulative_counts || [],
                                borderColor: '#667eea',
                                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                                fill: true
                            }]
                        },
                        options: { responsive: true, plugins: { legend: { display: false } } }
                    });
                });

            // Topic chart
            if (data.topic_distribution && Object.keys(data.topic_distribution).length > 0) {
                const labels = Object.keys(data.topic_distribution).slice(0, 10);
                const values = labels.map(k => data.topic_distribution[k]);
                
                if (topicChart) topicChart.destroy();
                const ctx = document.getElementById('topic-chart').getContext('2d');
                topicChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels.map(l => `Topic ${l}`),
                        datasets: [{
                            data: values,
                            backgroundColor: ['#667eea', '#764ba2', '#f59e0b', '#10b981', '#ef4444', '#3b82f6', '#8b5cf6', '#ec4899', '#14b8a6', '#f97316']
                        }]
                    },
                    options: { responsive: true }
                });
            }
        }

        // Load health status
        async function loadHealth() {
            try {
                const res = await fetch(`${API_BASE}/api/orchestrator/health`);
                const data = await res.json();
                
                const indicator = document.getElementById('health-indicator');
                const dot = indicator.querySelector('.status-dot');
                const text = indicator.querySelector('span');
                
                dot.className = `status-dot status-${data.status}`;
                text.textContent = data.status === 'healthy' ? 'System OK' : data.status;
            } catch (e) {
                console.error('Health check error:', e);
            }
        }

        // Load monitoring data
        async function loadMonitoring() {
            try {
                const [metricsRes, healthRes] = await Promise.all([
                    fetch(`${API_BASE}/api/orchestrator/metrics`),
                    fetch(`${API_BASE}/api/orchestrator/health`)
                ]);
                
                const metrics = await metricsRes.json();
                const health = await healthRes.json();

                // System metrics
                document.getElementById('system-metrics').innerHTML = `
                    <div class="flex justify-between items-center">
                        <span>CPU</span>
                        <div class="w-2/3 bg-gray-200 rounded-full h-4">
                            <div class="bg-blue-500 h-4 rounded-full" style="width: ${metrics.system?.cpu_percent || 0}%"></div>
                        </div>
                        <span class="ml-2">${metrics.system?.cpu_percent || 0}%</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>Memory</span>
                        <div class="w-2/3 bg-gray-200 rounded-full h-4">
                            <div class="bg-green-500 h-4 rounded-full" style="width: ${metrics.system?.memory_percent || 0}%"></div>
                        </div>
                        <span class="ml-2">${metrics.system?.memory_percent || 0}%</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>Disk</span>
                        <div class="w-2/3 bg-gray-200 rounded-full h-4">
                            <div class="bg-orange-500 h-4 rounded-full" style="width: ${metrics.system?.disk_percent || 0}%"></div>
                        </div>
                        <span class="ml-2">${metrics.system?.disk_percent || 0}%</span>
                    </div>
                `;

                // Health checks
                document.getElementById('health-checks').innerHTML = Object.entries(health.checks || {}).map(([name, check]) => `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <span class="capitalize">${name}</span>
                        <div class="flex items-center space-x-2">
                            <div class="status-dot status-${check.status}"></div>
                            <span class="text-sm">${check.message}</span>
                        </div>
                    </div>
                `).join('');

                // Pipeline stats
                document.getElementById('pipeline-stats').innerHTML = `
                    <div class="text-center p-4 bg-blue-50 rounded-lg">
                        <p class="text-2xl font-bold text-blue-600">${metrics.pipeline?.crawls_total || 0}</p>
                        <p class="text-sm text-gray-500">Total Crawls</p>
                    </div>
                    <div class="text-center p-4 bg-green-50 rounded-lg">
                        <p class="text-2xl font-bold text-green-600">${metrics.pipeline?.documents_crawled || 0}</p>
                        <p class="text-sm text-gray-500">Documents</p>
                    </div>
                    <div class="text-center p-4 bg-purple-50 rounded-lg">
                        <p class="text-2xl font-bold text-purple-600">${metrics.pipeline?.topics_trained || 0}</p>
                        <p class="text-sm text-gray-500">Topics Trained</p>
                    </div>
                    <div class="text-center p-4 bg-orange-50 rounded-lg">
                        <p class="text-2xl font-bold text-orange-600">${metrics.pipeline?.ner_extractions || 0}</p>
                        <p class="text-sm text-gray-500">NER Extractions</p>
                    </div>
                `;
            } catch (e) {
                console.error('Load monitoring error:', e);
            }
        }

        // Run pipeline
        async function runPipeline() {
            const url = document.getElementById('pipeline-url').value;
            if (!url) { alert('Please enter URL'); return; }

            const body = {
                url: url,
                mode: document.getElementById('pipeline-mode').value,
                train_topics: document.getElementById('pipeline-topics').checked,
                extract_ner: document.getElementById('pipeline-ner').checked,
                async_mode: true
            };

            try {
                const res = await fetch(`${API_BASE}/api/orchestrator/run`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });
                const data = await res.json();
                alert(`Pipeline submitted! Task ID: ${data.task_id}`);
                loadTasks();
            } catch (e) {
                alert('Error: ' + e.message);
            }
        }

        // Load tasks
        async function loadTasks() {
            try {
                const res = await fetch(`${API_BASE}/api/orchestrator/tasks`);
                const tasks = await res.json();

                document.getElementById('tasks-list').innerHTML = tasks.length ? tasks.map(t => `
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-medium">${t.name} - ${t.id}</p>
                                <p class="text-sm text-gray-500">${t.params?.url || ''}</p>
                            </div>
                            <div class="text-right">
                                <span class="px-3 py-1 rounded-full text-sm ${
                                    t.status === 'completed' ? 'bg-green-100 text-green-700' :
                                    t.status === 'running' ? 'bg-blue-100 text-blue-700' :
                                    t.status === 'failed' ? 'bg-red-100 text-red-700' :
                                    'bg-gray-100 text-gray-700'
                                }">${t.status}</span>
                                <p class="text-sm text-gray-500 mt-1">${t.progress}%</p>
                            </div>
                        </div>
                        ${t.status === 'running' ? `
                            <div class="mt-2 bg-gray-200 rounded-full h-2">
                                <div class="bg-blue-500 h-2 rounded-full transition-all" style="width: ${t.progress}%"></div>
                            </div>
                        ` : ''}
                    </div>
                `).join('') : '<p class="text-gray-500">No tasks</p>';
            } catch (e) {
                console.error('Load tasks error:', e);
            }
        }

        // Load HITL reviews
        async function loadHITL() {
            try {
                const [pendingRes, statsRes] = await Promise.all([
                    fetch(`${API_BASE}/api/hitl/topics/pending`),
                    fetch(`${API_BASE}/api/hitl/stats`)
                ]);

                const pending = await pendingRes.json();
                const stats = await statsRes.json();

                document.getElementById('pending-reviews').innerHTML = (pending.reviews || []).length ? pending.reviews.map(r => `
                    <div class="p-4 border rounded-lg">
                        <div class="flex justify-between">
                            <div>
                                <p class="font-medium">Topic ${r.topic_id}: ${r.original_label}</p>
                                <p class="text-sm text-gray-500">Suggested: ${r.suggested_label}</p>
                            </div>
                            <div class="space-x-2">
                                <button onclick="approveReview(${r.id})" class="px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button onclick="rejectReview(${r.id})" class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('') : '<p class="text-gray-500">No pending reviews</p>';

                document.getElementById('review-stats').innerHTML = `
                    <div class="text-center p-4 bg-yellow-50 rounded-lg">
                        <p class="text-2xl font-bold text-yellow-600">${stats.pending_topics || 0}</p>
                        <p class="text-sm">Pending</p>
                    </div>
                    <div class="text-center p-4 bg-green-50 rounded-lg">
                        <p class="text-2xl font-bold text-green-600">${stats.approved_topics || 0}</p>
                        <p class="text-sm">Approved</p>
                    </div>
                    <div class="text-center p-4 bg-red-50 rounded-lg">
                        <p class="text-2xl font-bold text-red-600">${stats.rejected_topics || 0}</p>
                        <p class="text-sm">Rejected</p>
                    </div>
                    <div class="text-center p-4 bg-blue-50 rounded-lg">
                        <p class="text-2xl font-bold text-blue-600">${stats.merged_topics || 0}</p>
                        <p class="text-sm">Merged</p>
                    </div>
                `;
            } catch (e) {
                console.error('Load HITL error:', e);
            }
        }

        // Load all topics
        async function loadAllTopics() {
            try {
                const res = await fetch(`${API_BASE}/api/topics`);
                const data = await res.json();

                document.getElementById('all-topics').innerHTML = (data.topics || []).map(t => `
                    <div class="p-4 border rounded-lg hover:shadow-md transition-all">
                        <div class="flex justify-between items-start">
                            <h4 class="font-medium">Topic ${t.topic_id}</h4>
                            <span class="bg-purple-100 text-purple-700 px-2 py-1 rounded text-sm">${t.count}</span>
                        </div>
                        <div class="mt-2 flex flex-wrap gap-1">
                            ${(t.words || []).slice(0, 5).map(w => `
                                <span class="bg-gray-100 px-2 py-1 rounded text-xs">${w.word}</span>
                            `).join('')}
                        </div>
                    </div>
                `).join('') || '<p class="text-gray-500">No topics</p>';
            } catch (e) {
                console.error('Load topics error:', e);
            }
        }

        // Approve/Reject reviews
        async function approveReview(id) {
            const label = prompt('Final label:');
            if (!label) return;
            
            await fetch(`${API_BASE}/api/hitl/topics/${id}/approve`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ final_label: label, status: 'approved' })
            });
            loadHITL();
        }

        async function rejectReview(id) {
            await fetch(`${API_BASE}/api/hitl/topics/${id}/approve`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ final_label: '', status: 'rejected' })
            });
            loadHITL();
        }

        // Auto-refresh
        setInterval(() => {
            if (!document.getElementById('tab-overview').classList.contains('hidden')) {
                loadOverview();
            }
        }, 30000);

        // Initial load
        loadOverview();
        loadHealth();
    </script>
</body>
</html>
